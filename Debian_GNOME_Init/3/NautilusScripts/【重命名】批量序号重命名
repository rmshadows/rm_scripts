#!/usr/bin/env python3
import os
import sys
import tkinter as tk
from tkinter import simpledialog

# 获取选中文件或文件夹路径
paths = sys.argv[1:]
if not paths:
    print("没有选中文件")
    sys.exit(1)

# 弹出输入框：起始编号
root = tk.Tk()
root.withdraw()

start_num = simpledialog.askinteger("起始编号", "请输入起始编号（默认为1）", initialvalue=1)
if start_num is None:
    sys.exit(0)

zero_pad = simpledialog.askstring("编号补零", "编号位数（如 2 表示01、02）\n留空则不补零：", initialvalue="2")
prefix = simpledialog.askstring("文件名前缀", "请输入前缀（可留空）", initialvalue="")

# 转换补零长度
pad_len = int(zero_pad) if zero_pad and zero_pad.isdigit() else 0

# 排序以保持稳定命名
paths = sorted(paths)

# 确保在同一目录下处理，避免跨目录重名错误
dir_path = os.path.dirname(paths[0])
ext_map = {}

for idx, path in enumerate(paths):
    full_path = os.path.abspath(path)
    dir_name = os.path.dirname(full_path)
    base_name = os.path.basename(full_path)
    ext = os.path.splitext(base_name)[1] if os.path.isfile(path) else ""

    num_str = str(start_num + idx).zfill(pad_len) if pad_len else str(start_num + idx)
    new_name = f"{prefix}{num_str}{ext}"
    new_path = os.path.join(dir_name, new_name)

    # 避免重名冲突
    if os.path.exists(new_path):
        print(f"跳过：{new_name} 已存在")
        continue

    os.rename(full_path, new_path)

