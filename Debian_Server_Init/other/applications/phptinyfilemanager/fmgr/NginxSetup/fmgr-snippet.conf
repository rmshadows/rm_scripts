# fmgr 专用 location 片段，不包含 server 块。
# 由 setupNginxForFmgr.sh 复制到 /etc/nginx/snippets/fmgr.conf 并填入 root 路径。
# 用户只需在自己的 site-enabled 里某个 server { } 内加一行：include /etc/nginx/snippets/fmgr.conf;

# root 由脚本根据 fmgr 目录自动填入
# /fmgr 路径：静态与 PHP 文件，root 为 fmgr 所在父目录（由 setupNginxForFmgr.sh 填入）
# 已覆盖 /fmgr/files/、/fmgr/files/tempUpload/（uploader.php $directories_users）等，无需单独重写
location /fmgr/ {
    rewrite ^/fmgr/(.*)$ /fmgr/$1 break;
    root __FMGR_PARENT__;
    autoindex on;              # 允许目录列表
    autoindex_exact_size off;  # 文件大小以可读单位显示
    autoindex_localtime off;   # 目录时间用 UTC
}

# /x 短路径：重写到 fmgr 首页
location /x {
    rewrite ^/x(/|/index\.html)?$ /fmgr/index.php;
}

# /fmgr/filesfmgr 错误路径修正：部分链接会误成 filesfmgr，重写为 /fmgr/files/...
location ~ ^/fmgr/filesfmgr {
    rewrite ^/fmgr/filesfmgr(.*)$ /fmgr/files$1;
}
